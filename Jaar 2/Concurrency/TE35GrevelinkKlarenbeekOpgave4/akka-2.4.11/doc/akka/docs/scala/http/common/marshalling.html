


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Marshalling &mdash; Akka Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/docs.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.4.11',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/toc.js"></script>
    <script type="text/javascript" src="../../../_static/prettify.js"></script>
    <script type="text/javascript" src="../../../_static/highlightCode.js"></script>
    <script type="text/javascript" src="../../../_static/effects.core.js"></script>
    <script type="text/javascript" src="../../../_static/effects.highlight.js"></script>
    <script type="text/javascript" src="../../../_static/scrollTo.js"></script>
    <script type="text/javascript" src="../../../_static/contentsFix.js"></script>
    <script type="text/javascript" src="../../../_static/ga.js"></script>
    <script type="text/javascript" src="../../../_static/warnOldDocs.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Akka Documentation" href="../../../index.html" />
    <link rel="up" title="Common Abstractions (Client- and Server-Side)" href="index.html" />
    <link rel="next" title="Unmarshalling" href="unmarshalling.html" />
    <link rel="prev" title="HTTP Model" href="http-model.html" />


  </head>
  <body>
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <div class="navbar-logo">
          <a href="http://akka.io"><img class="svg-logo" src="../../../_static/akka_full_color.svg" /></a>
        </div>
        <ul class="nav">
          <li><a href="http://akka.io/docs">Documentation</a></li>
          <li><a href="http://doc.akka.io/docs/akka/current/additional/faq.html">FAQ</a></li>
          <li><a href="http://akka.io/downloads">Download</a></li>
          <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>
          <li><a href="http://github.com/akka/akka">Code</a></li>
          <li><a href="http://www.lightbend.com/how/subscription">Commercial Support</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="container">
      <div class="page-title">Marshalling</div>
      <div class="pdf-link"><a href="../../../AkkaScala.pdf" title="Akka Scala Documentation"><img src="../../../_static/pdf-scala-icon.png" style="height: 40px;" /></a></div>
      <div class="pdf-link"><a href="../../../AkkaJava.pdf" title="Akka Java Documentation"><img src="../../../_static/pdf-java-icon.png" style="height: 40px;" /></a></div>
    </div>
    <div class="main-container">
      <div class="container">
        <div class="row">
          <div class="span12">
            <ul class="breadcrumb">
              <li>
                 <span class="divider">|</span> <a href="unmarshalling.html">Unmarshalling</a> <span class="divider">»</span>
              </li>
              <li>
                <a href="../../../java.html">Java Contents</a> <span class="divider">|</span> <a href="../../../scala.html">Scala Contents</a>
              </li>
              <li>
                <span class="divider">«</span> <a href="http-model.html">HTTP Model</a> <span class="divider">|</span>
              </li>
              <li style="float: left">
                Version 2.4.11
              </li>
              <li style="float: left">
                <input type="search" id="search" class="form-control" />
              </li>
            </ul>
          </div>
        </div>
        <div class="row"><div class="span9">
            
  <div class="section" id="marshalling">
<span id="http-marshalling-scala"></span><h1>Marshalling</h1>
<p>&quot;Marshalling&quot; is the process of converting a higher-level (object) structure into some kind of lower-level
representation, often a &quot;wire format&quot;. Other popular names for it are &quot;Serialization&quot; or &quot;Pickling&quot;.</p>
<p>In Akka HTTP &quot;Marshalling&quot; means the conversion of an object of type <tt class="docutils literal"><span class="pre">T</span></tt> into a lower-level target type,
e.g. a <tt class="docutils literal"><span class="pre">MessageEntity</span></tt> (which forms the &quot;entity body&quot; of an HTTP request or response) or a full <tt class="docutils literal"><span class="pre">HttpRequest</span></tt> or
<tt class="docutils literal"><span class="pre">HttpResponse</span></tt>.</p>
<div class="section" id="basic-design">
<h2>Basic Design</h2>
<p>Marshalling of instances of type <tt class="docutils literal"><span class="pre">A</span></tt> into instances of type <tt class="docutils literal"><span class="pre">B</span></tt> is performed by a <tt class="docutils literal"><span class="pre">Marshaller[A,</span> <span class="pre">B]</span></tt>.
Akka HTTP also predefines a number of helpful aliases for the types of marshallers that you'll likely work with most:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">type</span> <span class="kt">ToEntityMarshaller</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Marshaller</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">MessageEntity</span><span class="o">]</span>
<span class="k">type</span> <span class="kt">ToByteStringMarshaller</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Marshaller</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">ByteString</span><span class="o">]</span>
<span class="k">type</span> <span class="kt">ToHeadersAndEntityMarshaller</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Marshaller</span><span class="o">[</span><span class="kt">T</span>, <span class="o">(</span><span class="kt">immutable.Seq</span><span class="o">[</span><span class="kt">HttpHeader</span><span class="o">]</span>, <span class="kt">MessageEntity</span><span class="o">)]</span>
<span class="k">type</span> <span class="kt">ToResponseMarshaller</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Marshaller</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">HttpResponse</span><span class="o">]</span>
<span class="k">type</span> <span class="kt">ToRequestMarshaller</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Marshaller</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">HttpRequest</span><span class="o">]</span>
</pre></div>
</div>
<p>Contrary to what you might initially expect <tt class="docutils literal"><span class="pre">Marshaller[A,</span> <span class="pre">B]</span></tt> is not a plain function <tt class="docutils literal"><span class="pre">A</span> <span class="pre">=&gt;</span> <span class="pre">B</span></tt> but rather
essentially a function <tt class="docutils literal"><span class="pre">A</span> <span class="pre">=&gt;</span> <span class="pre">Future[List[Marshalling[B]]]</span></tt>.
Let's dissect this rather complicated looking signature piece by piece to understand what marshallers are designed this
way.
Given an instance of type <tt class="docutils literal"><span class="pre">A</span></tt> a <tt class="docutils literal"><span class="pre">Marshaller[A,</span> <span class="pre">B]</span></tt> produces:</p>
<p>1. A <tt class="docutils literal"><span class="pre">Future</span></tt>: This is probably quite clear. Marshallers are not required to synchronously produce a result, so instead
they return a future, which allows for asynchronicity in the marshalling process.</p>
<p>2. of <tt class="docutils literal"><span class="pre">List</span></tt>: Rather than only a single target representation for <tt class="docutils literal"><span class="pre">A</span></tt> marshallers can offer several ones. Which
one will be rendered onto the wire in the end is decided by content negotiation.
For example, the <tt class="docutils literal"><span class="pre">ToEntityMarshaller[OrderConfirmation]</span></tt> might offer a JSON as well as an XML representation.
The client can decide through the addition of an <tt class="docutils literal"><span class="pre">Accept</span></tt> request header which one is preferred. If the client doesn't
express a preference the first representation is picked.</p>
<p>3. of <tt class="docutils literal"><span class="pre">Marshalling[B]</span></tt>: Rather than returning an instance of <tt class="docutils literal"><span class="pre">B</span></tt> directly marshallers first produce a
<tt class="docutils literal"><span class="pre">Marshalling[B]</span></tt>. This allows for querying the <tt class="docutils literal"><span class="pre">MediaType</span></tt> and potentially the <tt class="docutils literal"><span class="pre">HttpCharset</span></tt> that the marshaller
will produce before the actual marshalling is triggered. Apart from enabling content negotiation this design allows for
delaying the actual construction of the marshalling target instance to the very last moment when it is really needed.</p>
<p>This is how <tt class="docutils literal"><span class="pre">Marshalling</span></tt> is defined:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Describes one possible option for marshalling a given value.</span>
<span class="cm"> */</span>
<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Marshalling</span><span class="o">[</span><span class="kt">+A</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="k">⇒</span> <span class="kt">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Marshalling</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Marshalling</span> <span class="o">{</span>

  <span class="cm">/**</span>
<span class="cm">   * A Marshalling to a specific [[akka.http.scaladsl.model.ContentType]].</span>
<span class="cm">   */</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">WithFixedContentType</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span>
    <span class="n">contentType</span><span class="k">:</span> <span class="kt">ContentType</span><span class="o">,</span>
    <span class="n">marshal</span><span class="k">:</span>     <span class="o">()</span> <span class="k">⇒</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Marshalling</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="k">⇒</span> <span class="kt">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">WithFixedContentType</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">copy</span><span class="o">(</span><span class="n">marshal</span> <span class="k">=</span> <span class="o">()</span> <span class="k">⇒</span> <span class="n">f</span><span class="o">(</span><span class="n">marshal</span><span class="o">()))</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * A Marshalling to a specific [[akka.http.scaladsl.model.MediaType]] with a flexible charset.</span>
<span class="cm">   */</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">WithOpenCharset</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span>
    <span class="n">mediaType</span><span class="k">:</span> <span class="kt">MediaType.WithOpenCharset</span><span class="o">,</span>
    <span class="n">marshal</span><span class="k">:</span>   <span class="kt">HttpCharset</span> <span class="k">⇒</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Marshalling</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="k">⇒</span> <span class="kt">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">WithOpenCharset</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">copy</span><span class="o">(</span><span class="n">marshal</span> <span class="k">=</span> <span class="n">cs</span> <span class="k">⇒</span> <span class="n">f</span><span class="o">(</span><span class="n">marshal</span><span class="o">(</span><span class="n">cs</span><span class="o">)))</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * A Marshalling to an unknown MediaType and charset.</span>
<span class="cm">   * Circumvents content negotiation.</span>
<span class="cm">   */</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Opaque</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">marshal</span><span class="k">:</span> <span class="o">()</span> <span class="k">⇒</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Marshalling</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="k">⇒</span> <span class="kt">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Opaque</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">copy</span><span class="o">(</span><span class="n">marshal</span> <span class="k">=</span> <span class="o">()</span> <span class="k">⇒</span> <span class="n">f</span><span class="o">(</span><span class="n">marshal</span><span class="o">()))</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="predefined-marshallers">
<h2>Predefined Marshallers</h2>
<p>Akka HTTP already predefines a number of marshallers for the most common types.
Specifically these are:</p>
<ul class="simple">
<li><a class="reference external" href="http://github.com/akka/akka/tree/v2.4.11/akka-http/src/main/scala/akka/http/scaladsl/marshalling/PredefinedToEntityMarshallers.scala">PredefinedToEntityMarshallers</a><ul>
<li><tt class="docutils literal"><span class="pre">Array[Byte]</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ByteString</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Array[Char]</span></tt></li>
<li><tt class="docutils literal"><span class="pre">String</span></tt></li>
<li><tt class="docutils literal"><span class="pre">akka.http.scaladsl.model.FormData</span></tt></li>
<li><tt class="docutils literal"><span class="pre">akka.http.scaladsl.model.MessageEntity</span></tt></li>
<li><tt class="docutils literal"><span class="pre">T</span> <span class="pre">&lt;:</span> <span class="pre">akka.http.scaladsl.model.Multipart</span></tt></li>
</ul>
</li>
<li><a class="reference external" href="http://github.com/akka/akka/tree/v2.4.11/akka-http/src/main/scala/akka/http/scaladsl/marshalling/PredefinedToResponseMarshallers.scala">PredefinedToResponseMarshallers</a><ul>
<li><tt class="docutils literal"><span class="pre">T</span></tt>, if a <tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt> is available</li>
<li><tt class="docutils literal"><span class="pre">HttpResponse</span></tt></li>
<li><tt class="docutils literal"><span class="pre">StatusCode</span></tt></li>
<li><tt class="docutils literal"><span class="pre">(StatusCode,</span> <span class="pre">T)</span></tt>, if a <tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt> is available</li>
<li><tt class="docutils literal"><span class="pre">(Int,</span> <span class="pre">T)</span></tt>, if a <tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt> is available</li>
<li><tt class="docutils literal"><span class="pre">(StatusCode,</span> <span class="pre">immutable.Seq[HttpHeader],</span> <span class="pre">T)</span></tt>, if a <tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt> is available</li>
<li><tt class="docutils literal"><span class="pre">(Int,</span> <span class="pre">immutable.Seq[HttpHeader],</span> <span class="pre">T)</span></tt>, if a <tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt> is available</li>
</ul>
</li>
<li><a class="reference external" href="http://github.com/akka/akka/tree/v2.4.11/akka-http/src/main/scala/akka/http/scaladsl/marshalling/PredefinedToRequestMarshallers.scala">PredefinedToRequestMarshallers</a><ul>
<li><tt class="docutils literal"><span class="pre">HttpRequest</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Uri</span></tt></li>
<li><tt class="docutils literal"><span class="pre">(HttpMethod,</span> <span class="pre">Uri,</span> <span class="pre">T)</span></tt>, if a <tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt> is available</li>
<li><tt class="docutils literal"><span class="pre">(HttpMethod,</span> <span class="pre">Uri,</span> <span class="pre">immutable.Seq[HttpHeader],</span> <span class="pre">T)</span></tt>, if a <tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt> is available</li>
</ul>
</li>
<li><a class="reference external" href="http://github.com/akka/akka/tree/v2.4.11/akka-http/src/main/scala/akka/http/scaladsl/marshalling/GenericMarshallers.scala">GenericMarshallers</a><ul>
<li><tt class="docutils literal"><span class="pre">Marshaller[Throwable,</span> <span class="pre">T]</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Marshaller[Option[A],</span> <span class="pre">B]</span></tt>, if a <tt class="docutils literal"><span class="pre">Marshaller[A,</span> <span class="pre">B]</span></tt> and an <tt class="docutils literal"><span class="pre">EmptyValue[B]</span></tt> is available</li>
<li><tt class="docutils literal"><span class="pre">Marshaller[Either[A1,</span> <span class="pre">A2],</span> <span class="pre">B]</span></tt>, if a <tt class="docutils literal"><span class="pre">Marshaller[A1,</span> <span class="pre">B]</span></tt> and a <tt class="docutils literal"><span class="pre">Marshaller[A2,</span> <span class="pre">B]</span></tt> is available</li>
<li><tt class="docutils literal"><span class="pre">Marshaller[Future[A],</span> <span class="pre">B]</span></tt>, if a <tt class="docutils literal"><span class="pre">Marshaller[A,</span> <span class="pre">B]</span></tt> is available</li>
<li><tt class="docutils literal"><span class="pre">Marshaller[Try[A],</span> <span class="pre">B]</span></tt>, if a <tt class="docutils literal"><span class="pre">Marshaller[A,</span> <span class="pre">B]</span></tt> is available</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="implicit-resolution">
<h2>Implicit Resolution</h2>
<p>The marshalling infrastructure of Akka HTTP relies on a type-class based approach, which means that <tt class="docutils literal"><span class="pre">Marshaller</span></tt>
instances from a certain type <tt class="docutils literal"><span class="pre">A</span></tt> to a certain type <tt class="docutils literal"><span class="pre">B</span></tt> have to be available implicitly.</p>
<p>The implicits for most of the predefined marshallers in Akka HTTP are provided through the companion object of the
<tt class="docutils literal"><span class="pre">Marshaller</span></tt> trait. This means that they are always available and never need to be explicitly imported.
Additionally, you can simply &quot;override&quot; them by bringing your own custom version into local scope.</p>
</div>
<div class="section" id="custom-marshallers">
<h2>Custom Marshallers</h2>
<p>Akka HTTP gives you a few convenience tools for constructing marshallers for your own types.
Before you do that you need to think about what kind of marshaller you want to create.
If all your marshaller needs to produce is a <tt class="docutils literal"><span class="pre">MessageEntity</span></tt> then you should probably provide a
<tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt>. The advantage here is that it will work on both the client- as well as the server-side since
a <tt class="docutils literal"><span class="pre">ToResponseMarshaller[T]</span></tt> as well as a <tt class="docutils literal"><span class="pre">ToRequestMarshaller[T]</span></tt> can automatically be created if a
<tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt> is available.</p>
<p>If, however, your marshaller also needs to set things like the response status code, the request method, the request URI
or any headers then a <tt class="docutils literal"><span class="pre">ToEntityMarshaller[T]</span></tt> won't work. You'll need to fall down to providing a
<tt class="docutils literal"><span class="pre">ToResponseMarshaller[T]</span></tt> or a <tt class="docutils literal"><span class="pre">ToRequestMarshaller[T]</span></tt> directly.</p>
<p>For writing your own marshallers you won't have to &quot;manually&quot; implement the <tt class="docutils literal"><span class="pre">Marshaller</span></tt> trait directly.
Rather, it should be possible to use one of the convenience construction helpers defined on the <tt class="docutils literal"><span class="pre">Marshaller</span></tt>
companion:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Marshaller</span>
  <span class="k">extends</span> <span class="nc">GenericMarshallers</span>
  <span class="k">with</span> <span class="nc">PredefinedToEntityMarshallers</span>
  <span class="k">with</span> <span class="nc">PredefinedToResponseMarshallers</span>
  <span class="k">with</span> <span class="nc">PredefinedToRequestMarshallers</span> <span class="o">{</span>

  <span class="cm">/**</span>
<span class="cm">   * Creates a [[Marshaller]] from the given function.</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">ExecutionContext</span> <span class="k">⇒</span> <span class="kt">A</span> <span class="k">⇒</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Marshalling</span><span class="o">[</span><span class="kt">B</span><span class="o">]]])</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span> <span class="o">{</span>
      <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span> <span class="kt">ExecutionContext</span><span class="o">)</span> <span class="k">=</span>
        <span class="k">try</span> <span class="n">f</span><span class="o">(</span><span class="n">ec</span><span class="o">)(</span><span class="n">value</span><span class="o">)</span>
        <span class="k">catch</span> <span class="o">{</span> <span class="k">case</span> <span class="nc">NonFatal</span><span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="k">⇒</span> <span class="nc">FastFuture</span><span class="o">.</span><span class="n">failed</span><span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="o">}</span>
    <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Helper for creating a [[Marshaller]] using the given function.</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">strict</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="k">⇒</span> <span class="kt">Marshalling</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Marshaller</span> <span class="o">{</span> <span class="k">_</span> <span class="k">⇒</span> <span class="n">a</span> <span class="k">⇒</span> <span class="nc">FastFuture</span><span class="o">.</span><span class="n">successful</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span> <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Helper for creating a &quot;super-marshaller&quot; from a number of &quot;sub-marshallers&quot;.</span>
<span class="cm">   * Content-negotiation determines, which &quot;sub-marshaller&quot; eventually gets to do the job.</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">oneOf</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">marshallers</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]*)</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Marshaller</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">ec</span> <span class="k">⇒</span> <span class="n">a</span> <span class="k">⇒</span> <span class="nc">FastFuture</span><span class="o">.</span><span class="n">sequence</span><span class="o">(</span><span class="n">marshallers</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">(</span><span class="n">a</span><span class="o">))).</span><span class="n">fast</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">toList</span><span class="o">)</span> <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Helper for creating a &quot;super-marshaller&quot; from a number of values and a function producing &quot;sub-marshallers&quot;</span>
<span class="cm">   * from these values. Content-negotiation determines, which &quot;sub-marshaller&quot; eventually gets to do the job.</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">oneOf</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">values</span><span class="k">:</span> <span class="kt">T*</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="kt">T</span> <span class="k">⇒</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">oneOf</span><span class="o">(</span><span class="n">values</span> <span class="n">map</span> <span class="n">f</span><span class="k">:</span> <span class="k">_</span><span class="kt">*</span><span class="o">)</span>

  <span class="cm">/**</span>
<span class="cm">   * Helper for creating a synchronous [[Marshaller]] to content with a fixed charset from the given function.</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">withFixedContentType</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">contentType</span><span class="k">:</span> <span class="kt">ContentType</span><span class="o">)(</span><span class="n">marshal</span><span class="k">:</span> <span class="kt">A</span> <span class="k">⇒</span> <span class="kt">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">strict</span> <span class="o">{</span> <span class="n">value</span> <span class="k">⇒</span> <span class="nc">Marshalling</span><span class="o">.</span><span class="nc">WithFixedContentType</span><span class="o">(</span><span class="n">contentType</span><span class="o">,</span> <span class="o">()</span> <span class="k">⇒</span> <span class="n">marshal</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Helper for creating a synchronous [[Marshaller]] to content with a negotiable charset from the given function.</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">withOpenCharset</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">mediaType</span><span class="k">:</span> <span class="kt">MediaType.WithOpenCharset</span><span class="o">)(</span><span class="n">marshal</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">HttpCharset</span><span class="o">)</span> <span class="k">⇒</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">strict</span> <span class="o">{</span> <span class="n">value</span> <span class="k">⇒</span> <span class="nc">Marshalling</span><span class="o">.</span><span class="nc">WithOpenCharset</span><span class="o">(</span><span class="n">mediaType</span><span class="o">,</span> <span class="n">charset</span> <span class="k">⇒</span> <span class="n">marshal</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">charset</span><span class="o">))</span> <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Helper for creating a synchronous [[Marshaller]] to non-negotiable content from the given function.</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">opaque</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">marshal</span><span class="k">:</span> <span class="kt">A</span> <span class="k">⇒</span> <span class="kt">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">strict</span> <span class="o">{</span> <span class="n">value</span> <span class="k">⇒</span> <span class="nc">Marshalling</span><span class="o">.</span><span class="nc">Opaque</span><span class="o">(()</span> <span class="k">⇒</span> <span class="n">marshal</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Helper for creating a [[Marshaller]] combined of the provided `marshal` function</span>
<span class="cm">   * and an implicit Marshaller which is able to produce the required final type.</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">combined</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">C</span><span class="o">](</span><span class="n">marshal</span><span class="k">:</span> <span class="kt">A</span> <span class="k">⇒</span> <span class="kt">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">m2</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">B</span>, <span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Marshaller</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">]</span> <span class="o">{</span> <span class="n">ec</span> <span class="k">⇒</span> <span class="n">a</span> <span class="k">⇒</span> <span class="n">m2</span><span class="o">.</span><span class="n">compose</span><span class="o">(</span><span class="n">marshal</span><span class="o">).</span><span class="n">apply</span><span class="o">(</span><span class="n">a</span><span class="o">)(</span><span class="n">ec</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="deriving-marshallers">
<h2>Deriving Marshallers</h2>
<p>Sometimes you can save yourself some work by reusing existing marshallers for your custom ones.
The idea is to &quot;wrap&quot; an existing marshaller with some logic to &quot;re-target&quot; it to your type.</p>
<p>In this regard wrapping a marshaller can mean one or both of the following two things:</p>
<ul class="simple">
<li>Transform the input before it reaches the wrapped marshaller</li>
<li>Transform the output of the wrapped marshaller</li>
</ul>
<p>For the latter (transforming the output) you can use <tt class="docutils literal"><span class="pre">baseMarshaller.map</span></tt>, which works exactly as it does for functions.
For the former (transforming the input) you have four alternatives:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">baseMarshaller.compose</span></tt></li>
<li><tt class="docutils literal"><span class="pre">baseMarshaller.composeWithEC</span></tt></li>
<li><tt class="docutils literal"><span class="pre">baseMarshaller.wrap</span></tt></li>
<li><tt class="docutils literal"><span class="pre">baseMarshaller.wrapWithEC</span></tt></li>
</ul>
<p><tt class="docutils literal"><span class="pre">compose</span></tt> works just like it does for functions.
<tt class="docutils literal"><span class="pre">wrap</span></tt> is a compose that allows you to also change the <tt class="docutils literal"><span class="pre">ContentType</span></tt> that the marshaller marshals to.
The <tt class="docutils literal"><span class="pre">...WithEC</span></tt> variants allow you to receive an <tt class="docutils literal"><span class="pre">ExecutionContext</span></tt> internally if you need one, without having to
depend on one being available implicitly at the usage site.</p>
</div>
<div class="section" id="using-marshallers">
<h2>Using Marshallers</h2>
<p>In many places throughput Akka HTTP marshallers are used implicitly, e.g. when you define how to <a class="reference internal" href="../routing-dsl/directives/route-directives/complete.html#complete"><em>complete</em></a> a
request using the <a class="reference internal" href="../routing-dsl/index.html#http-high-level-server-side-api"><em>Routing DSL</em></a>.</p>
<p>However, you can also use the marshalling infrastructure directly if you wish, which can be useful for example in tests.
The best entry point for this is the <tt class="docutils literal"><span class="pre">akka.http.scaladsl.marshalling.Marshal</span></tt> object, which you can use like this:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.concurrent.Await</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.marshalling.Marshal</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.model._</span>

<span class="k">import</span> <span class="nn">system.dispatcher</span> <span class="c1">// ExecutionContext</span>

<span class="k">val</span> <span class="n">string</span> <span class="k">=</span> <span class="s">&quot;Yeah&quot;</span>
<span class="k">val</span> <span class="n">entityFuture</span> <span class="k">=</span> <span class="nc">Marshal</span><span class="o">(</span><span class="n">string</span><span class="o">).</span><span class="n">to</span><span class="o">[</span><span class="kt">MessageEntity</span><span class="o">]</span>
<span class="k">val</span> <span class="n">entity</span> <span class="k">=</span> <span class="nc">Await</span><span class="o">.</span><span class="n">result</span><span class="o">(</span><span class="n">entityFuture</span><span class="o">,</span> <span class="mf">1.</span><span class="n">second</span><span class="o">)</span> <span class="c1">// don&#39;t block in non-test code!</span>
<span class="n">entity</span><span class="o">.</span><span class="n">contentType</span> <span class="n">shouldEqual</span> <span class="nc">ContentTypes</span><span class="o">.</span><span class="n">`text/plain(UTF-8)`</span>

<span class="k">val</span> <span class="n">errorMsg</span> <span class="k">=</span> <span class="s">&quot;Easy, pal!&quot;</span>
<span class="k">val</span> <span class="n">responseFuture</span> <span class="k">=</span> <span class="nc">Marshal</span><span class="o">(</span><span class="mi">420</span> <span class="o">-&gt;</span> <span class="n">errorMsg</span><span class="o">).</span><span class="n">to</span><span class="o">[</span><span class="kt">HttpResponse</span><span class="o">]</span>
<span class="k">val</span> <span class="n">response</span> <span class="k">=</span> <span class="nc">Await</span><span class="o">.</span><span class="n">result</span><span class="o">(</span><span class="n">responseFuture</span><span class="o">,</span> <span class="mf">1.</span><span class="n">second</span><span class="o">)</span> <span class="c1">// don&#39;t block in non-test code!</span>
<span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="n">shouldEqual</span> <span class="nc">StatusCodes</span><span class="o">.</span><span class="nc">EnhanceYourCalm</span>
<span class="n">response</span><span class="o">.</span><span class="n">entity</span><span class="o">.</span><span class="n">contentType</span> <span class="n">shouldEqual</span> <span class="nc">ContentTypes</span><span class="o">.</span><span class="n">`text/plain(UTF-8)`</span>

<span class="k">val</span> <span class="n">request</span> <span class="k">=</span> <span class="nc">HttpRequest</span><span class="o">(</span><span class="n">headers</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="n">headers</span><span class="o">.</span><span class="nc">Accept</span><span class="o">(</span><span class="nc">MediaTypes</span><span class="o">.</span><span class="n">`application/json`</span><span class="o">)))</span>
<span class="k">val</span> <span class="n">responseText</span> <span class="k">=</span> <span class="s">&quot;Plaintext&quot;</span>
<span class="k">val</span> <span class="n">respFuture</span> <span class="k">=</span> <span class="nc">Marshal</span><span class="o">(</span><span class="n">responseText</span><span class="o">).</span><span class="n">toResponseFor</span><span class="o">(</span><span class="n">request</span><span class="o">)</span> <span class="c1">// with content negotiation!</span>
<span class="n">a</span><span class="o">[</span><span class="kt">Marshal.UnacceptableResponseContentTypeException</span><span class="o">]</span> <span class="n">should</span> <span class="n">be</span> <span class="n">thrownBy</span> <span class="o">{</span>
  <span class="nc">Await</span><span class="o">.</span><span class="n">result</span><span class="o">(</span><span class="n">respFuture</span><span class="o">,</span> <span class="mf">1.</span><span class="n">second</span><span class="o">)</span> <span class="c1">// client requested JSON, we only have text/plain!</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <div class="span3"><p class="contents-title">Contents</p>
              <div id="scroller-anchor">
                <div id="scroller">
                  <div id="toc"></div>
                </div>
              </div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
  <div class="container">
    <ul>
      <li><h5>Akka</h5></li>
      <li><a href="http://akka.io/docs">Documentation</a></li>
      <li><a href="http://doc.akka.io/docs/akka/current/additional/faq.html">FAQ</a></li>
      <li><a href="http://akka.io/downloads">Downloads</a></li>
      <li><a href="http://akka.io/news">News</a></li>
      <li><a href="http://letitcrash.com">Blog</a></li>
    </ul>
    <ul>
      <li><h5>Contribute</h5></li>
      <li><a href="http://akka.io/community">Community Projects</a></li>
      <li><a href="http://github.com/akka/akka">Source Code</a></li>
      <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>
      <li><a href="http://doc.akka.io/docs/akka/current/project/issue-tracking.html">Report a Bug</a></li>
    </ul>
    <ul>
      <li><h5>Company</h5></li>
      <li><a href="http://www.lightbend.com/how/subscription">Commercial Support</a></li>
      <li><a href="http://akka.io/team">Team</a></li>
      <li><a href="mailto:info@lightbend.com">Contact</a></li>
    </ul>
    <ul>
      <li><img src="../../../_static/akka_icon_reverse.svg" align="center"/></li>
    </ul>
  </div>
  <div class="container copyright">
    <p style="float: left;">
      © 2015 <a href="http://www.lightbend.com/">Lightbend Inc.</a> <span class="license">Akka is Open Source and available under the Apache 2 License.</span>
    </p>
    <p style="float: right; font-size: 12px;">
      Last updated: Sep 30, 2016
    </p>
  </div>
</div>
<script type="text/javascript">
  var $toc = $('#toc');
  $toc.toc();

  // show clickable section sign when section header hovered:
  $('.section h2,.section h3,.section h4,.section h5').each(function(i, el) {
      var $el = $(el);
      $el.prepend($("<a class='section-marker' href='#" + $el.attr("id") + "'>&sect;</a>"))
  });
</script>

<!-- Algolia docs search -->
<script type="text/javascript">
  var version = DOCUMENTATION_OPTIONS.VERSION;

  var lang = "scala";
  var path = window.location.pathname;
  if (path.includes("/java/") || path.includes("java.html")) lang = "java";

  console.log("Search configured for:", lang, "@", version);

  docsearch({
    apiKey: '543bad5ad786495d9ccd445ed34ed082',
    indexName: 'akka_io',
    inputSelector: '#search',
    algoliaOptions: {
      hitsPerPage: 5,
      facetFilters: '[' + '["language:' + lang + '","language:general"]' + ',"version:' + version + '"]'
    }
  });

  // set up "/" as global shortcut for focusing on search
  $(document).keypress(function (event) {
    if (event.keyCode == 47) {
      $("#q").focus();
      return false; // swallow key event, otherwise the / char would be input into the search box
    }
  });
</script>

  

  </body>
</html>