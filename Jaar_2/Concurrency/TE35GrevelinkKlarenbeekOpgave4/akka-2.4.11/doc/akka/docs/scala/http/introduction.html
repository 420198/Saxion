


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction &mdash; Akka Documentation</title>
    
    <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/base.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/docs.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.4.11',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/toc.js"></script>
    <script type="text/javascript" src="../../_static/prettify.js"></script>
    <script type="text/javascript" src="../../_static/highlightCode.js"></script>
    <script type="text/javascript" src="../../_static/effects.core.js"></script>
    <script type="text/javascript" src="../../_static/effects.highlight.js"></script>
    <script type="text/javascript" src="../../_static/scrollTo.js"></script>
    <script type="text/javascript" src="../../_static/contentsFix.js"></script>
    <script type="text/javascript" src="../../_static/ga.js"></script>
    <script type="text/javascript" src="../../_static/warnOldDocs.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Akka Documentation" href="../../index.html" />
    <link rel="up" title="Akka HTTP" href="index.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Akka HTTP" href="index.html" />


  </head>
  <body>
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <div class="navbar-logo">
          <a href="http://akka.io"><img class="svg-logo" src="../../_static/akka_full_color.svg" /></a>
        </div>
        <ul class="nav">
          <li><a href="http://akka.io/docs">Documentation</a></li>
          <li><a href="http://doc.akka.io/docs/akka/current/additional/faq.html">FAQ</a></li>
          <li><a href="http://akka.io/downloads">Download</a></li>
          <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>
          <li><a href="http://github.com/akka/akka">Code</a></li>
          <li><a href="http://www.lightbend.com/how/subscription">Commercial Support</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="container">
      <div class="page-title">Introduction</div>
      <div class="pdf-link"><a href="../../AkkaScala.pdf" title="Akka Scala Documentation"><img src="../../_static/pdf-scala-icon.png" style="height: 40px;" /></a></div>
      <div class="pdf-link"><a href="../../AkkaJava.pdf" title="Akka Java Documentation"><img src="../../_static/pdf-java-icon.png" style="height: 40px;" /></a></div>
    </div>
    <div class="main-container">
      <div class="container">
        <div class="row">
          <div class="span12">
            <ul class="breadcrumb">
              <li>
                 <span class="divider">|</span> <a href="configuration.html">Configuration</a> <span class="divider">»</span>
              </li>
              <li>
                <a href="../../java.html">Java Contents</a> <span class="divider">|</span> <a href="../../scala.html">Scala Contents</a>
              </li>
              <li>
                <span class="divider">«</span> <a href="index.html">Akka HTTP</a> <span class="divider">|</span>
              </li>
              <li style="float: left">
                Version 2.4.11
              </li>
              <li style="float: left">
                <input type="search" id="search" class="form-control" />
              </li>
            </ul>
          </div>
        </div>
        <div class="row"><div class="span9">
            
  <div class="section" id="introduction">
<span id="http-introduction-scala"></span><h1>Introduction</h1>
<p>The Akka HTTP modules implement a full server- and client-side HTTP stack on top of <em>akka-actor</em> and <em>akka-stream</em>. It's
not a web-framework but rather a more general toolkit for providing and consuming HTTP-based services. While interaction
with a browser is of course also in scope it is not the primary focus of Akka HTTP.</p>
<p>Akka HTTP follows a rather open design and many times offers several different API levels for &quot;doing the same thing&quot;.
You get to pick the API level of abstraction that is most suitable for your application.
This means that, if you have trouble achieving something using a high-level API, there's a good chance that you can get
it done with a low-level API, which offers more flexibility but might require you to write more application code.</p>
<div class="section" id="philosophy">
<h2>Philosophy</h2>
<p>Akka HTTP has been driven with a clear focus on providing tools for building integration layers rather than application cores. As such it regards itself as a suite of libraries rather than a framework.</p>
<p>A framework, as we’d like to think of the term, gives you a “frame”, in which you build your application. It comes with a lot of decisions already pre-made and provides a foundation including support structures that lets you get started and deliver results quickly. In a way a framework is like a skeleton onto which you put the “flesh” of your application in order to have it come alive. As such frameworks work best if you choose them before you start application development and try to stick to the frameworks “way of doing things” as you go along.</p>
<p>For example, if you are building a browser-facing web application it makes sense to choose a web framework and build your application on top of it because the “core” of the application is the interaction of a browser with your code on the web-server. The framework makers have chosen one “proven” way of designing such applications and let you “fill in the blanks” of a more or less flexible “application-template”. Being able to rely on best-practice architecture like this can be a great asset for getting things done quickly.</p>
<p>However, if your application is not primarily a web application because its core is not browser-interaction but some specialized maybe complex business service and you are merely trying to connect it to the world via a REST/HTTP interface a web-framework might not be what you need. In this case the application architecture should be dictated by what makes sense for the core not the interface layer. Also, you probably won’t benefit from the possibly existing browser-specific framework components like view templating, asset management, JavaScript- and CSS generation/manipulation/minification, localization support, AJAX support, etc.</p>
<p>Akka HTTP was designed specifically as “not-a-framework”, not because we don’t like frameworks, but for use cases where a framework is not the right choice. Akka HTTP is made for building integration layers based on HTTP and as such tries to “stay on the sidelines”. Therefore you normally don’t build your application “on top of” Akka HTTP, but you build your application on top of whatever makes sense and use Akka HTTP merely for the HTTP integration needs.</p>
</div>
<div class="section" id="using-akka-http">
<h2>Using Akka HTTP</h2>
<p>Akka HTTP is provided in a separate jar file, to use it make sure to include the following dependency:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="s">&quot;com.typesafe.akka&quot;</span> <span class="o">%%</span> <span class="s">&quot;akka-http-experimental&quot;</span> <span class="o">%</span> <span class="s">&quot;2.4.11&quot;</span>
</pre></div>
</div>
<p>Mind that <tt class="docutils literal"><span class="pre">akka-http</span></tt> comes in two modules: <tt class="docutils literal"><span class="pre">akka-http-experimental</span></tt> and <tt class="docutils literal"><span class="pre">akka-http-core</span></tt>. Because <tt class="docutils literal"><span class="pre">akka-http-experimental</span></tt>
depends on <tt class="docutils literal"><span class="pre">akka-http-core</span></tt> you don't need to bring the latter explicitly. Still you may need to this in case you rely
solely on low-level API.</p>
</div>
<div class="section" id="routing-dsl-for-http-servers">
<h2>Routing DSL for HTTP servers</h2>
<p>The high-level, routing API of Akka HTTP provides a DSL to describe HTTP &quot;routes&quot; and how they should be handled.
Each route is composed of one or more level of <tt class="docutils literal"><span class="pre">Directive</span></tt> s that narrows down to handling one specific type of
request.</p>
<p>For example one route might start with matching the <tt class="docutils literal"><span class="pre">path</span></tt> of the request, only matching if it is &quot;/hello&quot;, then
narrowing it down to only handle HTTP <tt class="docutils literal"><span class="pre">get</span></tt> requests and then <tt class="docutils literal"><span class="pre">complete</span></tt> those with a string literal, which
will be sent back as a HTTP OK with the string as response body.</p>
<p>Transforming request and response bodies between over-the-wire formats and objects to be used in your application is
done separately from the route declarations, in marshallers, which are pulled in implicitly using the &quot;magnet&quot; pattern.
This means that you can <tt class="docutils literal"><span class="pre">complete</span></tt> a request with any kind of object a as long as there is an implicit marshaller
available in scope.</p>
<p>Default marshallers are provided for simple objects like String or ByteString, and you can define your own for example
for JSON. An additional module provides JSON serialization using the spray-json library (see <a class="reference internal" href="common/json-support.html#akka-http-spray-json"><em>JSON Support</em></a>
for details).</p>
<p>The <tt class="docutils literal"><span class="pre">Route</span></tt> created using the Route DSL is then &quot;bound&quot; to a port to start serving HTTP requests:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.Http</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.model._</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.server.Directives._</span>
<span class="k">import</span> <span class="nn">akka.stream.ActorMaterializer</span>
<span class="k">import</span> <span class="nn">scala.io.StdIn</span>

<span class="k">object</span> <span class="nc">WebServer</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>

    <span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">&quot;my-system&quot;</span><span class="o">)</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">materializer</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">()</span>
    <span class="c1">// needed for the future flatMap/onComplete in the end</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">executionContext</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">dispatcher</span>

    <span class="k">val</span> <span class="n">route</span> <span class="k">=</span>
      <span class="n">path</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">get</span> <span class="o">{</span>
          <span class="n">complete</span><span class="o">(</span><span class="nc">HttpEntity</span><span class="o">(</span><span class="nc">ContentTypes</span><span class="o">.</span><span class="n">`text/html(UTF-8)`</span><span class="o">,</span> <span class="s">&quot;&lt;h1&gt;Say hello to akka-http&lt;/h1&gt;&quot;</span><span class="o">))</span>
        <span class="o">}</span>
      <span class="o">}</span>

    <span class="k">val</span> <span class="n">bindingFuture</span> <span class="k">=</span> <span class="nc">Http</span><span class="o">().</span><span class="n">bindAndHandle</span><span class="o">(</span><span class="n">route</span><span class="o">,</span> <span class="s">&quot;localhost&quot;</span><span class="o">,</span> <span class="mi">8080</span><span class="o">)</span>

    <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Server online at http://localhost:8080/\nPress RETURN to stop...&quot;</span><span class="o">)</span>
    <span class="nc">StdIn</span><span class="o">.</span><span class="n">readLine</span><span class="o">()</span> <span class="c1">// let it run until user presses return</span>
    <span class="n">bindingFuture</span>
      <span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">unbind</span><span class="o">())</span> <span class="c1">// trigger unbinding from the port</span>
      <span class="o">.</span><span class="n">onComplete</span><span class="o">(</span><span class="k">_</span> <span class="k">=&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">terminate</span><span class="o">())</span> <span class="c1">// and shutdown when done</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>A common use case is to reply to a request using a model object having the marshaller transform it into JSON. In
this case shown by two separate routes. The first route queries an asynchronous database and marshalls the
<tt class="docutils literal"><span class="pre">Future[Option[Item]]</span></tt> result into a JSON response. The second unmarshalls an <tt class="docutils literal"><span class="pre">Order</span></tt> from the incoming request
saves it to the database and replies with an OK when done.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.Http</span>
<span class="k">import</span> <span class="nn">akka.stream.ActorMaterializer</span>
<span class="k">import</span> <span class="nn">akka.Done</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.server.Route</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.server.Directives._</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.model.StatusCodes</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.marshallers.sprayjson.SprayJsonSupport._</span>
<span class="k">import</span> <span class="nn">spray.json.DefaultJsonProtocol._</span>

<span class="k">import</span> <span class="nn">scala.io.StdIn</span>

<span class="k">import</span> <span class="nn">scala.concurrent.Future</span>

<span class="k">object</span> <span class="nc">WebServer</span> <span class="o">{</span>

  <span class="c1">// domain model</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Item</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Order</span><span class="o">(</span><span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Item</span><span class="o">])</span>

  <span class="c1">// formats for unmarshalling and marshalling</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">itemFormat</span> <span class="k">=</span> <span class="n">jsonFormat2</span><span class="o">(</span><span class="nc">Item</span><span class="o">)</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">orderFormat</span> <span class="k">=</span> <span class="n">jsonFormat1</span><span class="o">(</span><span class="nc">Order</span><span class="o">)</span>

  <span class="c1">// (fake) async database query api</span>
  <span class="k">def</span> <span class="n">fetchItem</span><span class="o">(</span><span class="n">itemId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Item</span><span class="o">]]</span> <span class="k">=</span> <span class="o">???</span>
  <span class="k">def</span> <span class="n">saveOrder</span><span class="o">(</span><span class="n">order</span><span class="k">:</span> <span class="kt">Order</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Done</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>

  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>

    <span class="c1">// needed to run the route</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">()</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">materializer</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">()</span>
    <span class="c1">// needed for the future map/flatmap in the end</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">executionContext</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">dispatcher</span>

    <span class="k">val</span> <span class="n">route</span><span class="k">:</span> <span class="kt">Route</span> <span class="o">=</span>
      <span class="n">get</span> <span class="o">{</span>
        <span class="n">pathPrefix</span><span class="o">(</span><span class="s">&quot;item&quot;</span> <span class="o">/</span> <span class="nc">LongNumber</span><span class="o">)</span> <span class="o">{</span> <span class="n">id</span> <span class="k">=&gt;</span>
          <span class="c1">// there might be no item for a given id</span>
          <span class="k">val</span> <span class="n">maybeItem</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Item</span><span class="o">]]</span> <span class="k">=</span> <span class="n">fetchItem</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>

          <span class="n">onSuccess</span><span class="o">(</span><span class="n">maybeItem</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">item</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">complete</span><span class="o">(</span><span class="n">item</span><span class="o">)</span>
            <span class="k">case</span> <span class="nc">None</span>       <span class="k">=&gt;</span> <span class="n">complete</span><span class="o">(</span><span class="nc">StatusCodes</span><span class="o">.</span><span class="nc">NotFound</span><span class="o">)</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span> <span class="o">~</span>
        <span class="n">post</span> <span class="o">{</span>
          <span class="n">path</span><span class="o">(</span><span class="s">&quot;create-order&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">entity</span><span class="o">(</span><span class="n">as</span><span class="o">[</span><span class="kt">Order</span><span class="o">])</span> <span class="o">{</span> <span class="n">order</span> <span class="k">=&gt;</span>
              <span class="k">val</span> <span class="n">saved</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Done</span><span class="o">]</span> <span class="k">=</span> <span class="n">saveOrder</span><span class="o">(</span><span class="n">order</span><span class="o">)</span>
              <span class="n">onComplete</span><span class="o">(</span><span class="n">saved</span><span class="o">)</span> <span class="o">{</span> <span class="n">done</span> <span class="k">=&gt;</span>
                <span class="n">complete</span><span class="o">(</span><span class="s">&quot;order created&quot;</span><span class="o">)</span>
              <span class="o">}</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">}</span>

    <span class="k">val</span> <span class="n">bindingFuture</span> <span class="k">=</span> <span class="nc">Http</span><span class="o">().</span><span class="n">bindAndHandle</span><span class="o">(</span><span class="n">route</span><span class="o">,</span> <span class="s">&quot;localhost&quot;</span><span class="o">,</span> <span class="mi">8080</span><span class="o">)</span>
    <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Server online at http://localhost:8080/\nPress RETURN to stop...&quot;</span><span class="o">)</span>
    <span class="nc">StdIn</span><span class="o">.</span><span class="n">readLine</span><span class="o">()</span> <span class="c1">// let it run until user presses return</span>
    <span class="n">bindingFuture</span>
      <span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">unbind</span><span class="o">())</span> <span class="c1">// trigger unbinding from the port</span>
      <span class="o">.</span><span class="n">onComplete</span><span class="o">(</span><span class="k">_</span> <span class="k">⇒</span> <span class="n">system</span><span class="o">.</span><span class="n">terminate</span><span class="o">())</span> <span class="c1">// and shutdown when done</span>

  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The logic for the marshalling and unmarshalling JSON in this example is provided by the &quot;spray-json&quot; library
(details on how to use that here: <a class="reference internal" href="common/json-support.html#akka-http-spray-json"><em>JSON Support</em></a>).</p>
<p>One of the strengths of Akka HTTP is that streaming data is at its heart meaning that both request and response bodies
can be streamed through the server achieving constant memory usage even for very large requests or responses. Streaming
responses will be backpressured by the remote client so that the server will not push data faster than the client can
handle, streaming requests means that the server decides how fast the remote client can push the data of the request
body.</p>
<p>Example that streams random numbers as long as the client accepts them:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.stream.scaladsl._</span>
<span class="k">import</span> <span class="nn">akka.util.ByteString</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.Http</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.model.</span><span class="o">{</span><span class="nc">HttpEntity</span><span class="o">,</span> <span class="nc">ContentTypes</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.server.Directives._</span>
<span class="k">import</span> <span class="nn">akka.stream.ActorMaterializer</span>
<span class="k">import</span> <span class="nn">scala.util.Random</span>
<span class="k">import</span> <span class="nn">scala.io.StdIn</span>

<span class="k">object</span> <span class="nc">WebServer</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>

    <span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">()</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">materializer</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">()</span>
    <span class="c1">// needed for the future flatMap/onComplete in the end</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">executionContext</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">dispatcher</span>

    <span class="c1">// streams are re-usable so we can define it here</span>
    <span class="c1">// and use it for every request</span>
    <span class="k">val</span> <span class="n">numbers</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromIterator</span><span class="o">(()</span> <span class="k">=&gt;</span>
      <span class="nc">Iterator</span><span class="o">.</span><span class="n">continually</span><span class="o">(</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextInt</span><span class="o">()))</span>

    <span class="k">val</span> <span class="n">route</span> <span class="k">=</span>
      <span class="n">path</span><span class="o">(</span><span class="s">&quot;random&quot;</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">get</span> <span class="o">{</span>
          <span class="n">complete</span><span class="o">(</span>
            <span class="nc">HttpEntity</span><span class="o">(</span>
              <span class="nc">ContentTypes</span><span class="o">.</span><span class="n">`text/plain(UTF-8)`</span><span class="o">,</span>
              <span class="c1">// transform each number to a chunk of bytes</span>
              <span class="n">numbers</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">n</span> <span class="k">=&gt;</span> <span class="nc">ByteString</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;$n\n&quot;</span><span class="o">))</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">}</span>
      <span class="o">}</span>

    <span class="k">val</span> <span class="n">bindingFuture</span> <span class="k">=</span> <span class="nc">Http</span><span class="o">().</span><span class="n">bindAndHandle</span><span class="o">(</span><span class="n">route</span><span class="o">,</span> <span class="s">&quot;localhost&quot;</span><span class="o">,</span> <span class="mi">8080</span><span class="o">)</span>
    <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Server online at http://localhost:8080/\nPress RETURN to stop...&quot;</span><span class="o">)</span>
    <span class="nc">StdIn</span><span class="o">.</span><span class="n">readLine</span><span class="o">()</span> <span class="c1">// let it run until user presses return</span>
    <span class="n">bindingFuture</span>
      <span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">unbind</span><span class="o">())</span> <span class="c1">// trigger unbinding from the port</span>
      <span class="o">.</span><span class="n">onComplete</span><span class="o">(</span><span class="k">_</span> <span class="k">=&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">terminate</span><span class="o">())</span> <span class="c1">// and shutdown when done</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Connecting to this service with a slow HTTP client would backpressure so that the next random number is produced on
demand with constant memory usage on the server. This can be seen using curl and limiting the rate
<tt class="docutils literal"><span class="pre">curl</span> <span class="pre">--limit-rate</span> <span class="pre">50b</span> <span class="pre">127.0.0.1:8080/random</span></tt></p>
<p>Akka HTTP routes easily interacts with actors. In this example one route allows for placing bids in a fire-and-forget
style while the second route contains a request-response interaction with an actor. The resulting response is rendered
as json and returned when the response arrives from the actor.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.Http</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.model.StatusCodes</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.server.Directives._</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.marshallers.sprayjson.SprayJsonSupport._</span>
<span class="k">import</span> <span class="nn">akka.pattern.ask</span>
<span class="k">import</span> <span class="nn">akka.stream.ActorMaterializer</span>
<span class="k">import</span> <span class="nn">akka.util.Timeout</span>
<span class="k">import</span> <span class="nn">spray.json.DefaultJsonProtocol._</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">import</span> <span class="nn">scala.io.StdIn</span>

<span class="k">object</span> <span class="nc">WebServer</span> <span class="o">{</span>

  <span class="k">case</span> <span class="k">class</span> <span class="nc">Bid</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">bid</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">GetBids</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">Bids</span><span class="o">(</span><span class="n">bids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Bid</span><span class="o">])</span>

  <span class="c1">// these are from spray-json</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">bidFormat</span> <span class="k">=</span> <span class="n">jsonFormat2</span><span class="o">(</span><span class="nc">Bid</span><span class="o">)</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">bidsFormat</span> <span class="k">=</span> <span class="n">jsonFormat1</span><span class="o">(</span><span class="nc">Bids</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">()</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">materializer</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">()</span>
    <span class="c1">// needed for the future flatMap/onComplete in the end</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">executionContext</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">dispatcher</span>

    <span class="k">val</span> <span class="n">auction</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">Auction</span><span class="o">.</span><span class="n">props</span><span class="o">,</span> <span class="s">&quot;auction&quot;</span><span class="o">)</span>

    <span class="k">val</span> <span class="n">route</span> <span class="k">=</span>
      <span class="n">path</span><span class="o">(</span><span class="s">&quot;auction&quot;</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">put</span> <span class="o">{</span>
          <span class="n">parameter</span><span class="o">(</span><span class="s">&quot;bid&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="s">&quot;user&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="n">bid</span><span class="o">,</span> <span class="n">user</span><span class="o">)</span> <span class="k">=&gt;</span>
            <span class="c1">// place a bid, fire-and-forget</span>
            <span class="n">auction</span> <span class="o">!</span> <span class="nc">Bid</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">bid</span><span class="o">)</span>
            <span class="n">complete</span><span class="o">((</span><span class="nc">StatusCodes</span><span class="o">.</span><span class="nc">Accepted</span><span class="o">,</span> <span class="s">&quot;bid placed&quot;</span><span class="o">))</span>
          <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">get</span> <span class="o">{</span>
          <span class="k">implicit</span> <span class="k">val</span> <span class="n">timeout</span><span class="k">:</span> <span class="kt">Timeout</span> <span class="o">=</span> <span class="mf">5.</span><span class="n">seconds</span>

          <span class="c1">// query the actor for the current auction state</span>
          <span class="k">val</span> <span class="n">bids</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Bids</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="n">auction</span> <span class="o">?</span> <span class="nc">GetBids</span><span class="o">).</span><span class="n">mapTo</span><span class="o">[</span><span class="kt">Bids</span><span class="o">]</span>
          <span class="n">complete</span><span class="o">(</span><span class="n">bids</span><span class="o">)</span>
        <span class="o">}</span>
      <span class="o">}</span>

    <span class="k">val</span> <span class="n">bindingFuture</span> <span class="k">=</span> <span class="nc">Http</span><span class="o">().</span><span class="n">bindAndHandle</span><span class="o">(</span><span class="n">route</span><span class="o">,</span> <span class="s">&quot;localhost&quot;</span><span class="o">,</span> <span class="mi">8080</span><span class="o">)</span>
    <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Server online at http://localhost:8080/\nPress RETURN to stop...&quot;</span><span class="o">)</span>
    <span class="nc">StdIn</span><span class="o">.</span><span class="n">readLine</span><span class="o">()</span> <span class="c1">// let it run until user presses return</span>
    <span class="n">bindingFuture</span>
      <span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">unbind</span><span class="o">())</span> <span class="c1">// trigger unbinding from the port</span>
      <span class="o">.</span><span class="n">onComplete</span><span class="o">(</span><span class="k">_</span> <span class="k">=&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">terminate</span><span class="o">())</span> <span class="c1">// and shutdown when done</span>

  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Again the logic for the marshalling and unmarshalling JSON in this example is provided by the &quot;spray-json&quot; library
(details on how to use that here: <a class="reference internal" href="common/json-support.html#akka-http-spray-json"><em>JSON Support</em></a>)</p>
<p>Read more about the details of the high level APIs in the section <a class="reference internal" href="routing-dsl/index.html#http-high-level-server-side-api"><em>High-level Server-Side API</em></a>.</p>
</div>
<div class="section" id="low-level-http-server-apis">
<h2>Low-level HTTP server APIs</h2>
<p>The low-level Akka HTTP server APIs allows for handling connections or individual requests by accepting
<tt class="docutils literal"><span class="pre">HttpRequest</span></tt> s and answering them by producing <tt class="docutils literal"><span class="pre">HttpResponse</span></tt> s. This is provided by the <tt class="docutils literal"><span class="pre">akka-http-core</span></tt> module.
APIs for handling such request-responses as function calls and as a <tt class="docutils literal"><span class="pre">Flow[HttpRequest,</span> <span class="pre">HttpResponse,</span> <span class="pre">_]</span></tt> are available.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.Http</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.model.HttpMethods._</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.model._</span>
<span class="k">import</span> <span class="nn">akka.stream.ActorMaterializer</span>
<span class="k">import</span> <span class="nn">scala.io.StdIn</span>

<span class="k">object</span> <span class="nc">WebServer</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">()</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">materializer</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">()</span>
    <span class="c1">// needed for the future map/flatmap in the end</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">executionContext</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">dispatcher</span>

    <span class="k">val</span> <span class="n">requestHandler</span><span class="k">:</span> <span class="kt">HttpRequest</span> <span class="o">=&gt;</span> <span class="nc">HttpResponse</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">HttpRequest</span><span class="o">(</span><span class="nc">GET</span><span class="o">,</span> <span class="nc">Uri</span><span class="o">.</span><span class="nc">Path</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">),</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="nc">HttpResponse</span><span class="o">(</span><span class="n">entity</span> <span class="k">=</span> <span class="nc">HttpEntity</span><span class="o">(</span>
          <span class="nc">ContentTypes</span><span class="o">.</span><span class="n">`text/html(UTF-8)`</span><span class="o">,</span>
          <span class="s">&quot;&lt;html&gt;&lt;body&gt;Hello world!&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="o">))</span>

      <span class="k">case</span> <span class="nc">HttpRequest</span><span class="o">(</span><span class="nc">GET</span><span class="o">,</span> <span class="nc">Uri</span><span class="o">.</span><span class="nc">Path</span><span class="o">(</span><span class="s">&quot;/ping&quot;</span><span class="o">),</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="nc">HttpResponse</span><span class="o">(</span><span class="n">entity</span> <span class="k">=</span> <span class="s">&quot;PONG!&quot;</span><span class="o">)</span>

      <span class="k">case</span> <span class="nc">HttpRequest</span><span class="o">(</span><span class="nc">GET</span><span class="o">,</span> <span class="nc">Uri</span><span class="o">.</span><span class="nc">Path</span><span class="o">(</span><span class="s">&quot;/crash&quot;</span><span class="o">),</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">error</span><span class="o">(</span><span class="s">&quot;BOOM!&quot;</span><span class="o">)</span>

      <span class="k">case</span> <span class="n">r</span><span class="k">:</span> <span class="kt">HttpRequest</span> <span class="o">=&gt;</span>
        <span class="n">r</span><span class="o">.</span><span class="n">discardEntityBytes</span><span class="o">()</span> <span class="c1">// important to drain incoming HTTP Entity stream</span>
        <span class="nc">HttpResponse</span><span class="o">(</span><span class="mi">404</span><span class="o">,</span> <span class="n">entity</span> <span class="k">=</span> <span class="s">&quot;Unknown resource!&quot;</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="k">val</span> <span class="n">bindingFuture</span> <span class="k">=</span> <span class="nc">Http</span><span class="o">().</span><span class="n">bindAndHandleSync</span><span class="o">(</span><span class="n">requestHandler</span><span class="o">,</span> <span class="s">&quot;localhost&quot;</span><span class="o">,</span> <span class="mi">8080</span><span class="o">)</span>
    <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Server online at http://localhost:8080/\nPress RETURN to stop...&quot;</span><span class="o">)</span>
    <span class="nc">StdIn</span><span class="o">.</span><span class="n">readLine</span><span class="o">()</span> <span class="c1">// let it run until user presses return</span>
    <span class="n">bindingFuture</span>
      <span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">unbind</span><span class="o">())</span> <span class="c1">// trigger unbinding from the port</span>
      <span class="o">.</span><span class="n">onComplete</span><span class="o">(</span><span class="k">_</span> <span class="k">=&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">terminate</span><span class="o">())</span> <span class="c1">// and shutdown when done</span>

  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Read more details about the low level APIs in the section <a class="reference internal" href="low-level-server-side-api.html#http-low-level-server-side-api"><em>Low-Level Server-Side API</em></a>.</p>
</div>
<div class="section" id="http-client-api">
<h2>HTTP client API</h2>
<p>The client APIs provide methods for calling a HTTP server using the same <tt class="docutils literal"><span class="pre">HttpRequest</span></tt> and <tt class="docutils literal"><span class="pre">HttpResponse</span></tt> abstractions
that Akka HTTP server uses but adds the concept of connection pools to allow multiple requests to the same server to be
handled more performantly by re-using TCP connections to the server.</p>
<p>Example simple request:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.http.scaladsl.Http</span>
<span class="k">import</span> <span class="nn">akka.http.scaladsl.model._</span>
<span class="k">import</span> <span class="nn">akka.stream.ActorMaterializer</span>

<span class="k">import</span> <span class="nn">scala.concurrent.Future</span>
<span class="k">import</span> <span class="nn">scala.util.</span><span class="o">{</span> <span class="nc">Failure</span><span class="o">,</span> <span class="nc">Success</span> <span class="o">}</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">()</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">materializer</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">()</span>

<span class="k">val</span> <span class="n">responseFuture</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">HttpResponse</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Http</span><span class="o">().</span><span class="n">singleRequest</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">(</span><span class="n">uri</span> <span class="k">=</span> <span class="s">&quot;http://akka.io&quot;</span><span class="o">))</span>
</pre></div>
</div>
<p>Read more about the details of the client APIs in the section <a class="reference internal" href="client-side/index.html#http-client-side"><em>Consuming HTTP-based Services (Client-Side)</em></a>.</p>
</div>
<div class="section" id="the-modules-that-make-up-akka-http">
<h2>The modules that make up Akka HTTP</h2>
<p>Akka HTTP is structured into several modules:</p>
<dl class="docutils">
<dt>akka-http</dt>
<dd>Higher-level functionality, like (un)marshalling, (de)compression as well as a powerful DSL
for defining HTTP-based APIs on the server-side, this is the recommended way to write HTTP servers
with Akka HTTP. Details can be found in the section <a class="reference internal" href="routing-dsl/index.html#http-high-level-server-side-api"><em>High-level Server-Side API</em></a></dd>
<dt>akka-http-core</dt>
<dd>A complete, mostly low-level, server- and client-side implementation of HTTP (incl. WebSockets)
Details can be found in sections <a class="reference internal" href="low-level-server-side-api.html#http-low-level-server-side-api"><em>Low-Level Server-Side API</em></a> and <a class="reference internal" href="client-side/index.html#http-client-side"><em>Consuming HTTP-based Services (Client-Side)</em></a></dd>
<dt>akka-http-testkit</dt>
<dd>A test harness and set of utilities for verifying server-side service implementations</dd>
<dt>akka-http-spray-json</dt>
<dd>Predefined glue-code for (de)serializing custom types from/to JSON with <a class="reference external" href="https://github.com/spray/spray-json">spray-json</a>
Details can be found here: <a class="reference internal" href="common/json-support.html#akka-http-spray-json"><em>JSON Support</em></a></dd>
<dt>akka-http-xml</dt>
<dd>Predefined glue-code for (de)serializing custom types from/to XML with <a class="reference external" href="https://github.com/scala/scala-xml">scala-xml</a>
Details can be found here: <a class="reference internal" href="common/xml-support.html#akka-http-xml-marshalling"><em>XML Support</em></a></dd>
</dl>
</div>
</div>


          </div>
          <div class="span3"><p class="contents-title">Contents</p>
              <div id="scroller-anchor">
                <div id="scroller">
                  <div id="toc"></div>
                </div>
              </div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
  <div class="container">
    <ul>
      <li><h5>Akka</h5></li>
      <li><a href="http://akka.io/docs">Documentation</a></li>
      <li><a href="http://doc.akka.io/docs/akka/current/additional/faq.html">FAQ</a></li>
      <li><a href="http://akka.io/downloads">Downloads</a></li>
      <li><a href="http://akka.io/news">News</a></li>
      <li><a href="http://letitcrash.com">Blog</a></li>
    </ul>
    <ul>
      <li><h5>Contribute</h5></li>
      <li><a href="http://akka.io/community">Community Projects</a></li>
      <li><a href="http://github.com/akka/akka">Source Code</a></li>
      <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>
      <li><a href="http://doc.akka.io/docs/akka/current/project/issue-tracking.html">Report a Bug</a></li>
    </ul>
    <ul>
      <li><h5>Company</h5></li>
      <li><a href="http://www.lightbend.com/how/subscription">Commercial Support</a></li>
      <li><a href="http://akka.io/team">Team</a></li>
      <li><a href="mailto:info@lightbend.com">Contact</a></li>
    </ul>
    <ul>
      <li><img src="../../_static/akka_icon_reverse.svg" align="center"/></li>
    </ul>
  </div>
  <div class="container copyright">
    <p style="float: left;">
      © 2015 <a href="http://www.lightbend.com/">Lightbend Inc.</a> <span class="license">Akka is Open Source and available under the Apache 2 License.</span>
    </p>
    <p style="float: right; font-size: 12px;">
      Last updated: Sep 30, 2016
    </p>
  </div>
</div>
<script type="text/javascript">
  var $toc = $('#toc');
  $toc.toc();

  // show clickable section sign when section header hovered:
  $('.section h2,.section h3,.section h4,.section h5').each(function(i, el) {
      var $el = $(el);
      $el.prepend($("<a class='section-marker' href='#" + $el.attr("id") + "'>&sect;</a>"))
  });
</script>

<!-- Algolia docs search -->
<script type="text/javascript">
  var version = DOCUMENTATION_OPTIONS.VERSION;

  var lang = "scala";
  var path = window.location.pathname;
  if (path.includes("/java/") || path.includes("java.html")) lang = "java";

  console.log("Search configured for:", lang, "@", version);

  docsearch({
    apiKey: '543bad5ad786495d9ccd445ed34ed082',
    indexName: 'akka_io',
    inputSelector: '#search',
    algoliaOptions: {
      hitsPerPage: 5,
      facetFilters: '[' + '["language:' + lang + '","language:general"]' + ',"version:' + version + '"]'
    }
  });

  // set up "/" as global shortcut for focusing on search
  $(document).keypress(function (event) {
    if (event.keyCode == 47) {
      $("#q").focus();
      return false; // swallow key event, otherwise the / char would be input into the search box
    }
  });
</script>

  

  </body>
</html>